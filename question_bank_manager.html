<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Anjali ‚Äì Question Bank Manager</title>
<style>
body{margin:0;font-family:system-ui;background:#f4f6fb}
header{background:#8b2d2d;color:#fff;padding:14px;text-align:center;font-size:20px}
#layout{display:flex;height:calc(100vh - 60px)}
#tree{width:340px;background:#fff;border-right:1px solid #ccc;padding:10px;overflow-y:auto}
#panel{flex:1;padding:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}

/* ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•Ç‡§ö‡•Ä */
.subject{font-weight:bold;color:#8b2d2d;margin-top:8px;cursor:pointer}
.topic{margin-left:14px;padding:4px;border-radius:6px;cursor:pointer}
.topic.active{background:#8b2d2d;color:#fff}

/* ‡§¨‡§°‡§º‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤-‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§¨‡•â‡§ï‡•ç‡§∏ */
.big-box{
 width:90%;
 max-width:600px;
 height:70vh;
 background:#fff;
 border:2px solid #8b2d2d;
 border-radius:12px;
 padding:10px;
 overflow-y:auto;
 display:flex;
 flex-direction:column-reverse;
 box-shadow:0 0 10px rgba(0,0,0,0.25);
}

.btn-group{
 display:flex;
 justify-content:space-around;
 margin-bottom:10px;
 width:100%;
}

button{
 flex:1;
 margin:4px;
 padding:10px;
 border:none;
 border-radius:6px;
 font-size:16px;
 background:#8b2d2d;
 color:#fff;
 cursor:pointer;
 transition:0.3s;
}
button:hover{opacity:0.8}

#anjaliBtn{
 background:#e91e63;
 font-weight:bold;
 position:absolute;
 bottom:10px;
 right:20px;
}

.question{border-bottom:1px dashed #ccc;padding:6px 0;}
hr{border:none;border-top:1px dashed #ccc}
</style>
</head>

<body>
<header>üìö Anjali ‚Äì Question Bank Manager</header>

<div id="layout">
  <!-- ‡§¨‡§æ‡§à‡§Ç ‡§ì‡§∞ ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•Ç‡§ö‡•Ä -->
  <div id="tree"></div>

  <!-- ‡§¶‡§æ‡§à‡§Ç ‡§ì‡§∞ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•à‡§®‡§≤ -->
  <div id="panel">
    <h3 id="path">‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h3>

    <div class="btn-group">
      <button onclick="showSection('mcq')">Quiz Bank (MCQ)</button>
      <button onclick="showSection('one')">One-Liner</button>
      <button onclick="showSection('all')">Combined</button>
    </div>

    <div class="big-box">
      <div id="content">‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•Ç‡§ö‡•Ä ‡§∏‡•á ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç‡•§</div>
    </div>

    <button id="anjaliBtn" onclick="toggleVoice()">üé§ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä (‡§Ü‡§µ‡§æ‡§ú‡§º)</button>
  </div>
</div>

<script>
let DB=JSON.parse(localStorage.getItem("anjaliDB"))||{};
const tree=document.getElementById("tree");
let currentExam,currentSubject,currentTopic;
let currentData = [];
let voiceActive = false;
let synth = window.speechSynthesis;
let recognition;

/* ---- ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•Ç‡§ö‡•Ä (Tree) ‡§¨‡§®‡§æ‡§®‡§æ ---- */
for(let e in DB){
 let h=document.createElement("h3");h.textContent=e;tree.appendChild(h);
 for(let s in DB[e]){
  let sd=document.createElement("div");sd.className="subject";sd.textContent=s;
  let list=document.createElement("div");
  for(let t in DB[e][s]){
   let td=document.createElement("div");td.className="topic";td.textContent=t;
   td.onclick=()=>{
     document.querySelectorAll(".topic").forEach(x=>x.classList.remove("active"));
     td.classList.add("active");
     currentExam=e;currentSubject=s;currentTopic=t;
     path.textContent=e+" ‚Üí "+s+" ‚Üí "+t;
     renderAll();
   };
   list.appendChild(td);
  }
  tree.appendChild(sd);tree.appendChild(list);
 }
}

/* ---- MCQ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ---- */
function isValidMCQ(q){
 return q.type==="mcq"&&q.q&&q.a&&q.b&&q.c&&q.d&&["A","B","C","D"].includes(q.correct);
}

/* ---- ‡§µ‡§ø‡§∑‡§Ø ‡§¨‡§¶‡§≤‡§®‡•á ‡§™‡§∞ ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡§®‡§æ ---- */
function renderAll(){
 let arr=DB[currentExam][currentSubject][currentTopic]||[];
 currentData = arr; 
 document.getElementById("content").innerHTML =
   "<i>‡§ï‡•ã‡§à ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§</i>";
}

/* ---- ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§°‡•á‡§ü‡§æ ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ ---- */
function showSection(type){
 if(!currentExam||!currentSubject||!currentTopic){
   document.getElementById("content").innerHTML="<i>‡§™‡§π‡§≤‡•á ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç‡•§</i>";
   return;
 }
 let arr=DB[currentExam][currentSubject][currentTopic]||[];
 let html="";
 if(type==='mcq'){
   currentData = arr.filter(isValidMCQ);
   html=currentData.map((q,i)=>`
     <div class='question'>
     <b>${i+1}. ${q.q}</b><br>
     A) ${q.a}<br>B) ${q.b}<br>C) ${q.c}<br>D) ${q.d}<br>
     ‚úî ${q.correct}<br><i>${q.exp||""}</i>
     </div>`).join("");
 }
 else if(type==='one'){
   currentData = arr.filter(x=>x.type==='one-liner');
   html=currentData.map((o,i)=>`<div class='question'>${i+1}. ${o.q}</div>`).join("");
 }
 else{
   currentData = arr;
   html=currentData.map((x,i)=>isValidMCQ(x)?
   `<div class='question'><b>${i+1}. ${x.q}</b><br>A) ${x.a} B) ${x.b}<br>C) ${x.c} D) ${x.d}<br>‚úî ${x.correct}<br><i>${x.exp||""}</i></div>`:
   `<div class='question'>${i+1}. ${x.q}</div>`).join("");
 }

 document.getElementById("content").innerHTML = html || "<i>‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç</i>";
 if(voiceActive){ readQuestionsInteractive(); }
}

/* ---- ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ---- */
function toggleVoice(){
 voiceActive = !voiceActive;
 let btn = document.getElementById("anjaliBtn");
 if(voiceActive){
   btn.textContent="üîä ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§¨‡•ã‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à...";
   readQuestionsInteractive();
 } else {
   btn.textContent="üé§ ‡§Ö‡§Ç‡§ú‡§≤‡•Ä (‡§Ü‡§µ‡§æ‡§ú‡§º)";
   synth.cancel();
   if(recognition){ recognition.stop(); }
 }
}

/* ---- ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ø‡§ï‡§æ ‡§ú‡•à‡§∏‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡§¢‡§º‡§®‡§æ ‡§î‡§∞ ‡§â‡§§‡•ç‡§§‡§∞ ‡§∏‡•Å‡§®‡§®‡§æ ---- */
function readQuestionsInteractive(){
 if(!currentData.length){ return; }
 synth.cancel();

 let voices = synth.getVoices();
 let femaleVoice = voices.find(v=>v.name.includes('Google ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§Æ‡§π‡§ø‡§≤‡§æ') || v.name.includes('Female')) || voices[0];

 window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
 recognition = new SpeechRecognition();
 recognition.lang = 'hi-IN';
 recognition.interimResults = false;

 let i=0;
 function speakAndListen(){
   if(i>=currentData.length){ 
     speak("‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§è‡•§ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§ï‡§ø‡§Ø‡§æ!", femaleVoice);
     return; 
   }

   let q = currentData[i];
   let text = `‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${i+1}. ${q.q}. ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§π‡•à‡§Ç ‚Äî A) ${q.a}, B) ${q.b}, C) ${q.c}, D) ${q.d}. ‡§Ö‡§¨ ‡§¨‡§§‡§æ‡§á‡§è ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?`;
   
   speak(text, femaleVoice, ()=>{
     listenOnce(15, answer=>{
       let correct = q.correct ? q.correct.trim().toUpperCase() : "";
       let exp = q.exp || "‡§ï‡•ã‡§à ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
       let userAnswer = normalizeAnswer(answer);

       if(!userAnswer){  
         speak(`‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§Æ‡•à‡§Ç ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å, ‡§á‡§∏‡•á ‡§Ø‡§æ‡§¶ ‡§ï‡§∞ ‡§≤‡•á‡§®‡§æ‡•§`, femaleVoice, ()=>{
           speak(`‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§π‡•à ${correct}. ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ: ${exp}`, femaleVoice, ()=>next());
         });
       } else if(userAnswer === correct){
         speak(`‡§Ü‡§™‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§∏‡§π‡•Ä ‡§π‡•à, ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ‡•§`, femaleVoice, ()=>{
           speak(`‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§π‡•à ${correct}. ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ: ${exp}`, femaleVoice, ()=>next());
         });
       } else {
         speak(`‡§Æ‡•à‡§Ç ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ ‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å, ‡§á‡§∏‡•á ‡§Ø‡§æ‡§¶ ‡§ï‡§∞ ‡§≤‡•á‡§®‡§æ‡•§`, femaleVoice, ()=>{
           speak(`‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§π‡•à ${correct}. ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ: ${exp}`, femaleVoice, ()=>next());
         });
       }
     });
   });
 }

 function next(){
   i++;
   setTimeout(speakAndListen,2000);
 }

 speakAndListen();
}

/* ---- ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§¨‡•ã‡§≤‡•á ‡§ó‡§è ‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡•ã ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§¨‡§®‡§æ‡§®‡§æ ---- */
function normalizeAnswer(ans){
 if(!ans) return "";
 ans = ans.toLowerCase().trim();

 // ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§î‡§∞ ‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡§º‡•Ä ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§æ‡§®‡§ï A/B/C/D ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§®‡§æ
 if(ans.includes("‡§è") || ans.includes("a")) return "A";
 if(ans.includes("‡§¨‡•Ä") || ans.includes("b")) return "B";
 if(ans.includes("‡§∏‡•Ä") || ans.includes("c")) return "C";
 if(ans.includes("‡§°‡•Ä") || ans.includes("d")) return "D";

 // fallback
 if(ans.includes("‡§™‡§π‡§≤‡§æ")) return "A";
 if(ans.includes("‡§¶‡•Ç‡§∏‡§∞‡§æ")) return "B";
 if(ans.includes("‡§§‡•Ä‡§∏‡§∞‡§æ")) return "C";
 if(ans.includes("‡§ö‡•å‡§•‡§æ")) return "D";

 return "";
}

/* ---- ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•á ‡§¨‡•ã‡§≤‡§®‡§æ ---- */
function speak(text, voice, cb){
 let utter = new SpeechSynthesisUtterance(text);
 utter.lang='hi-IN';
 utter.voice = voice;
 utter.rate = 1;
 utter.pitch = 1.05;
 utter.onend = ()=>cb && cb();
 synth.speak(utter);
}

/* ---- ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•á ‡§∏‡•Å‡§®‡§®‡§æ (15 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ü‡§æ‡§á‡§Æ‡§Ü‡§â‡§ü ‡§∏‡§π‡§ø‡§§) ---- */
function listenOnce(timeoutSec, callback){
 if(!recognition) return;
 let answered = false;
 recognition.start();

 let timer = setTimeout(()=>{
   if(!answered){
     recognition.stop();
     callback("");
   }
 }, timeoutSec * 1000);

 recognition.onresult = (event)=>{
   answered = true;
   clearTimeout(timer);
   let ans = event.results[0][0].transcript;
   recognition.stop();
   callback(ans);
 };

 recognition.onerror = ()=>{
   clearTimeout(timer);
   callback("");
 };
}
</script>
</body>
</html>
