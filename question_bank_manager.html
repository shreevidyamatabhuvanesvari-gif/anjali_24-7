<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Anjali ‚Äì Question Bank Manager</title>

<style>
body{margin:0;font-family:system-ui;background:#f4f6fb}
header{background:#8b2d2d;color:#fff;padding:14px;text-align:center;font-size:20px}

#layout{display:flex;height:calc(100vh - 60px)}
#tree{width:340px;background:#fff;border-right:1px solid #ccc;overflow:auto;padding:10px}
#panel{flex:1;padding:12px;overflow:auto}

.subject{font-weight:bold;color:#8b2d2d;margin-top:8px;cursor:pointer}
.topic{margin-left:14px;padding:4px;border-radius:6px;cursor:pointer}
.topic:hover{background:#eee}
.topic.active{background:#8b2d2d;color:#fff}

.box{border:1px solid #ccc;border-radius:8px;padding:10px;margin-bottom:12px;background:#fff}
hr{border:none;border-top:1px dashed #ccc;margin:8px 0}
.small{font-size:13px;color:#555}
</style>
</head>

<body>
<header>üìö Anjali ‚Äì Question Bank Manager</header>

<div id="layout">

<!-- LEFT TREE -->
<div id="tree"></div>

<!-- RIGHT PANEL -->
<div id="panel">
<h3 id="path">‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h3>

<div class="box">
<b>üìò Quiz Bank (MCQ)</b>
<div id="mcqView"></div>
</div>

<div class="box">
<b>üìå One-Liner / Notes</b>
<div id="oneView"></div>
</div>

<div class="box">
<b>üìö Combined View</b>
<div id="allView"></div>
</div>

</div>
</div>

<script>
/* ================= DATABASE ================= */
/* Same DB as Control Panel */
let DB = JSON.parse(localStorage.getItem("anjaliDB")) || {};

/* ================= TREE ================= */
let currentExam=null,currentSubject=null,currentTopic=null;
const tree=document.getElementById("tree");

for(let exam in DB){
 let eh=document.createElement("h3");
 eh.textContent=exam;
 tree.appendChild(eh);

 for(let subject in DB[exam]){
  let s=document.createElement("div");
  s.className="subject";
  s.textContent=subject;

  let list=document.createElement("div");

  for(let topic in DB[exam][subject]){
   let t=document.createElement("div");
   t.className="topic";
   t.textContent=topic;

   t.onclick=()=>{
    document.querySelectorAll(".topic").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    currentExam=exam;
    currentSubject=subject;
    currentTopic=topic;
    path.textContent=exam+" ‚Üí "+subject+" ‚Üí "+topic;
    renderAll();
   };
   list.appendChild(t);
  }

  s.onclick=()=>list.style.display=list.style.display==="none"?"block":"none";
  tree.appendChild(s);
  tree.appendChild(list);
 }
}

/* ================= HELPERS ================= */

function isValidMCQ(q){
 return q.type==="mcq" &&
        q.q &&
        q.a && q.b && q.c && q.d &&
        q.correct &&
        ["A","B","C","D"].includes(q.correct);
}

/* ================= RENDER ================= */

function renderAll(){
 if(!currentTopic) return;

 let data = DB[currentExam][currentSubject][currentTopic] || [];

 let mcqs = data.filter(isValidMCQ);
 let ones = data.filter(x=>x.type==="one-liner");

 /* ---- MCQ VIEW ---- */
 mcqView.innerHTML = mcqs.length ? mcqs.map((q,i)=>`
  <b>${i+1}. ${q.q}</b><br>
  A) ${q.a}<br>
  B) ${q.b}<br>
  C) ${q.c}<br>
  D) ${q.d}<br>
  ‚úî <b>${q.correct}</b><br>
  <i>${q.exp || ""}</i>
  <div class="small">Pattern: ${q.pattern || "-"} | Difficulty: ${q.difficulty || "-"}</div>
  <hr>
 `).join("") : "<i>‡§ï‡•ã‡§à ‡§µ‡•à‡§ß MCQ ‡§®‡§π‡•Ä‡§Ç</i>";

 /* ---- ONE-LINER VIEW ---- */
 oneView.innerHTML = ones.length ? ones.map((o,i)=>`
  ${i+1}. ${o.q}<hr>
 `).join("") : "<i>‡§ï‡•ã‡§à One-Liner ‡§®‡§π‡•Ä‡§Ç</i>";

 /* ---- COMBINED VIEW ---- */
 allView.innerHTML = data.length ? data.map((x,i)=>{
  if(isValidMCQ(x)){
   return `
    <b>${i+1}. ${x.q}</b><br>
    A) ${x.a} &nbsp; B) ${x.b}<br>
    C) ${x.c} &nbsp; D) ${x.d}<br>
    ‚úî ${x.correct}<br>
    <i>${x.exp || ""}</i><hr>
   `;
  }
  if(x.type==="one-liner"){
   return `${i+1}. ${x.q}<hr>`;
  }
  return "";
 }).join("") : "<i>‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç</i>";
}
</script>

</body>
</html>
