<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Anjali тАУ Universal Exam Control Panel</title>

<style>
body{margin:0;font-family:system-ui;background:#f5f6fa}
header{background:#8b2d2d;color:#fff;padding:14px;text-align:center;font-size:20px}
#layout{display:flex;height:calc(100vh - 60px)}
#tree{width:340px;background:#fff;border-right:1px solid #ddd;overflow:auto;padding:10px}
#panel{flex:1;padding:10px;overflow:auto}
.subject{font-weight:bold;color:#8b2d2d;margin-top:8px;cursor:pointer}
.topic{margin-left:14px;padding:4px;border-radius:6px;cursor:pointer}
.topic.active{background:#8b2d2d;color:#fff}
textarea{width:100%;min-height:180px;padding:8px}
button{padding:6px 14px;margin:4px;border:none;border-radius:6px;background:#8b2d2d;color:#fff;cursor:pointer}
.danger{background:#b00020}
.box{border:1px dashed #aaa;padding:10px;margin-top:10px;border-radius:8px;background:#fff}
.big{min-height:220px;overflow:auto}
.item{border-bottom:1px dashed #ccc;padding:6px 0}
</style>
</head>

<body>
<header>ЁЯУЪ Anjali тАУ Universal Exam Control Panel</header>

<div id="layout">
<div id="tree"></div>

<div id="panel">
<h3 id="path">рдХреЛрдИ рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ</h3>

<!-- QUIZ -->
<div class="box">
<b>ЁЯУШ Quiz Bank (Bulk MCQ)</b>
<textarea id="quizBox" placeholder="Q: рдкреНрд░рд╢реНрди
A) рд╡рд┐рдХрд▓реНрдк
B) рд╡рд┐рдХрд▓реНрдк
C) рд╡рд┐рдХрд▓реНрдк
D) рд╡рд┐рдХрд▓реНрдк
Ans: A
Exp: рд╡реНрдпрд╛рдЦреНрдпрд╛"></textarea>
<button onclick="addQuiz()">тЮХ Question Bank рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ</button>
<button class="danger" onclick="deleteSelected('mcq')">ЁЯЧСя╕П рдЪреБрдиреЗ рд╣реБрдП Delete</button>
<div id="quizPreview" class="big"></div>
</div>

<!-- ONE LINER -->
<div class="box">
<b>ЁЯУМ One-Liner / Notes</b>
<textarea id="oneBox" placeholder="рд╣рд░ рд▓рд╛рдЗрди = рдПрдХ One-Liner"></textarea>
<button onclick="addOne()">тЮХ Question Bank рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ</button>
<button class="danger" onclick="deleteSelected('one-liner')">ЁЯЧСя╕П рдЪреБрдиреЗ рд╣реБрдП Delete</button>
<div id="onePreview" class="big"></div>
</div>

<!-- COMBINED -->
<div class="box">
<b>ЁЯУЪ Combined View</b>
<textarea id="combinedBox" placeholder="MCQ + One-Liner рджреЛрдиреЛрдВ рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ"></textarea>
<button onclick="addCombined()">тЮХ Question Bank рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ</button>
<button class="danger" onclick="deleteSelected('all')">ЁЯЧСя╕П рдЪреБрдиреЗ рд╣реБрдП Delete</button>
<div id="combinedPreview" class="big"></div>
</div>

<button onclick="openQuestionBank()">ЁЯУЪ Question Bank Manager</button>
</div>
</div>

<script>
/* ================= DATABASE ================= */
const SYLLABUS={
 "UP Police Constable":{
  "General Knowledge":{
   "A. History":[],
   "B. Geography":[],
   "C. Polity":[],
   "D. Economy":[],
   "E. Science":[],
   "F. Current Affairs":[]
  }
 }
};

let DB=JSON.parse(localStorage.getItem("anjaliDB"))||SYLLABUS;
function saveDB(){localStorage.setItem("anjaliDB",JSON.stringify(DB));}

let currentExam,currentSubject,currentTopic;
const tree=document.getElementById("tree");

/* ================= TREE ================= */
for(let e in DB){
 let h=document.createElement("h3");h.textContent=e;tree.appendChild(h);
 for(let s in DB[e]){
  let sd=document.createElement("div");sd.className="subject";sd.textContent=s;
  let list=document.createElement("div");
  for(let t in DB[e][s]){
   let td=document.createElement("div");td.className="topic";td.textContent=t;
   td.onclick=()=>{
    document.querySelectorAll(".topic").forEach(x=>x.classList.remove("active"));
    td.classList.add("active");
    currentExam=e;currentSubject=s;currentTopic=t;
    path.textContent=e+" тЖТ "+s+" тЖТ "+t;
    render();
   };
   list.appendChild(td);
  }
  tree.appendChild(sd);tree.appendChild(list);
 }
}

/* ================= PARSER ================= */
function parseMCQs(text){
 const blocks=text.split(/\n\s*\n/);
 const out=[];
 blocks.forEach(b=>{
  const q =(b.match(/Q:\s*(.+)/i)||[])[1];
  const a =(b.match(/A\)\s*(.+)/i)||[])[1];
  const b1=(b.match(/B\)\s*(.+)/i)||[])[1];
  const c =(b.match(/C\)\s*(.+)/i)||[])[1];
  const d =(b.match(/D\)\s*(.+)/i)||[])[1];
  const ans=(b.match(/Ans:\s*([ABCD])/i)||[])[1];
  const exp=(b.match(/Exp:\s*(.+)/i)||[])[1]||"";

  if(q&&a&&b1&&c&&d&&ans){
   out.push({
    type:"mcq",
    q:q.trim(),
    a:a.trim(),
    b:b1.trim(),
    c:c.trim(),
    d:d.trim(),
    correct:ans.trim(),
    exp:exp.trim()
   });
  }
 });
 return out;
}

/* ================= ADD ================= */
function addQuiz(){
 parseMCQs(quizBox.value).forEach(x=>{
  DB[currentExam][currentSubject][currentTopic].push(x);
 });
 quizBox.value=""; saveDB(); render();
}

function addOne(){
 oneBox.value.split("\n").forEach(l=>{
  if(l.trim()){
   DB[currentExam][currentSubject][currentTopic]
    .push({type:"one-liner",q:l.trim()});
  }
 });
 oneBox.value=""; saveDB(); render();
}

function addCombined(){
 const text=combinedBox.value;

 parseMCQs(text).forEach(x=>{
  DB[currentExam][currentSubject][currentTopic].push(x);
 });

 text.split("\n").forEach(l=>{
  if(l.trim() && !l.trim().startsWith("Q:")){
   DB[currentExam][currentSubject][currentTopic]
    .push({type:"one-liner",q:l.trim()});
  }
 });

 combinedBox.value=""; saveDB(); render();
}

/* ================= DELETE ================= */
function deleteSelected(mode){
 let arr=DB[currentExam][currentSubject][currentTopic];
 DB[currentExam][currentSubject][currentTopic]=arr.filter((x,i)=>{
  const cb=document.getElementById("cb_"+i);
  if(!cb||!cb.checked) return true;
  if(mode==="all") return false;
  return x.type!==mode;
 });
 saveDB(); render();
}

/* ================= RENDER ================= */
function render(){
 const arr=DB[currentExam][currentSubject][currentTopic];

 quizPreview.innerHTML=arr.map((x,i)=>x.type==="mcq"?`
  <div class="item">
   <input type="checkbox" id="cb_${i}">
   ${x.q}
  </div>`:"").join("");

 onePreview.innerHTML=arr.map((x,i)=>x.type==="one-liner"?`
  <div class="item">
   <input type="checkbox" id="cb_${i}">
   ${x.q}
  </div>`:"").join("");

 combinedPreview.innerHTML=arr.map((x,i)=>`
  <div class="item">
   <input type="checkbox" id="cb_${i}">
   ${x.q}
  </div>`).join("");
}

function openQuestionBank(){
 location.href="question_bank_manager.html";
}
</script>
</body>
</html>
