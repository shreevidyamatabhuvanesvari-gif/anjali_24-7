/* ======================================================
   ðŸ§  ANJALI â€“ CENTRAL EXAM ENGINE (PRODUCTION)
   Exam-grade | Browser-safe | No import/export
====================================================== */

(function () {

  /* ========= PUBLIC API ========= */
  window.extractExamFacts = function (articleText, contextPath) {

    if (!articleText || articleText.length < 50) return [];

    const lines = normalize(articleText);
    let facts = [];

    /* ===== ROUTE BY CONTEXT ===== */
    if (contextPath.includes("Economy")) {
      facts = facts.concat(economyEngine(lines));
    }

    /* ===== FINAL OUTPUT ===== */
    facts = deduplicateFacts(facts);
    return convertFactsToMCQ(facts);
  };

  /* ======================================================
     ðŸ”µ ECONOMY : EXAM CONTEXT ENGINE
  ====================================================== */

  function economyEngine(lines) {
    let facts = [];

    lines.forEach(line => {

      /* 1ï¸âƒ£ Economic Nature */
      if (has(line, ["à¤®à¤¿à¤¶à¥à¤°à¤¿à¤¤ à¤…à¤°à¥à¤¥à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾"])) {
        facts.push({
          q: "à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤…à¤°à¥à¤¥à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾ à¤•à¤¿à¤¸ à¤ªà¥à¤°à¤•à¤¾à¤° à¤•à¥€ à¤¹à¥ˆ?",
          ans: "à¤®à¤¿à¤¶à¥à¤°à¤¿à¤¤ à¤…à¤°à¥à¤¥à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾"
        });
      }

      /* 2ï¸âƒ£ Sectors */
      if (has(line, ["à¤•à¥ƒà¤·à¤¿", "à¤‰à¤¦à¥à¤¯à¥‹à¤—", "à¤¸à¥‡à¤µà¤¾"])) {
        facts.push({
          q: "à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤…à¤°à¥à¤¥à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾ à¤•à¤¿à¤¨ à¤¤à¥€à¤¨ à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¥‹à¤‚ à¤ªà¤° à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤¹à¥ˆ?",
          ans: "à¤•à¥ƒà¤·à¤¿, à¤‰à¤¦à¥à¤¯à¥‹à¤— à¤”à¤° à¤¸à¥‡à¤µà¤¾ à¤•à¥à¤·à¥‡à¤¤à¥à¤°"
        });
      }

      /* 3ï¸âƒ£ Monetary Authority */
      if (has(line, ["à¤°à¤¿à¤œà¤¼à¤°à¥à¤µ à¤¬à¥ˆà¤‚à¤•", "RBI"])) {
        facts.push({
          q: "à¤­à¤¾à¤°à¤¤ à¤•à¥€ à¤®à¥Œà¤¦à¥à¤°à¤¿à¤• à¤¨à¥€à¤¤à¤¿ à¤•à¥Œà¤¨ à¤¸à¤‚à¤šà¤¾à¤²à¤¿à¤¤ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ?",
          ans: "à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤°à¤¿à¤œà¤¼à¤°à¥à¤µ à¤¬à¥ˆà¤‚à¤•"
        });
      }

      /* 4ï¸âƒ£ Liberalisation */
      if (has(line, ["à¤‰à¤¦à¤¾à¤°à¥€à¤•à¤°à¤£", "1991"])) {
        facts.push({
          q: "à¤­à¤¾à¤°à¤¤ à¤®à¥‡à¤‚ à¤†à¤°à¥à¤¥à¤¿à¤• à¤‰à¤¦à¤¾à¤°à¥€à¤•à¤°à¤£ à¤•à¤¬ à¤²à¤¾à¤—à¥‚ à¤¹à¥à¤†?",
          ans: "1991"
        });
      }

      /* 5ï¸âƒ£ Foreign Investment */
      if (has(line, ["à¤µà¤¿à¤¦à¥‡à¤¶à¥€ à¤¨à¤¿à¤µà¥‡à¤¶"])) {
        facts.push({
          q: "à¤‰à¤¦à¤¾à¤°à¥€à¤•à¤°à¤£ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤­à¤¾à¤°à¤¤ à¤®à¥‡à¤‚ à¤•à¤¿à¤¸à¤•à¤¾ à¤ªà¥à¤°à¤µà¤¾à¤¹ à¤¬à¤¢à¤¼à¤¾?",
          ans: "à¤µà¤¿à¤¦à¥‡à¤¶à¥€ à¤¨à¤¿à¤µà¥‡à¤¶"
        });
      }

      /* 6ï¸âƒ£ Employment */
      if (has(line, ["à¤°à¥‹à¤œà¤—à¤¾à¤°", "à¤†à¤¬à¤¾à¤¦à¥€"])) {
        facts.push({
          q: "à¤­à¤¾à¤°à¤¤ à¤®à¥‡à¤‚ à¤¸à¤¬à¤¸à¥‡ à¤…à¤§à¤¿à¤• à¤°à¥‹à¤œà¤—à¤¾à¤° à¤•à¤¿à¤¸ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤¸à¥‡ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?",
          ans: "à¤•à¥ƒà¤·à¤¿ à¤•à¥à¤·à¥‡à¤¤à¥à¤°"
        });
      }

      /* 7ï¸âƒ£ Growth Status */
      if (has(line, ["à¤‰à¤­à¤°à¤¤à¥€", "à¤µà¤¿à¤•à¤¾à¤¸à¤¶à¥€à¤²"])) {
        facts.push({
          q: "à¤­à¤¾à¤°à¤¤ à¤•à¥‹ à¤•à¤¿à¤¸ à¤ªà¥à¤°à¤•à¤¾à¤° à¤•à¥€ à¤…à¤°à¥à¤¥à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾ à¤®à¤¾à¤¨à¤¾ à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆ?",
          ans: "à¤‰à¤­à¤°à¤¤à¥€ à¤¹à¥à¤ˆ à¤…à¤°à¥à¤¥à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾"
        });
      }

      /* 8ï¸âƒ£ Banking Role */
      if (has(line, ["à¤¬à¥ˆà¤‚à¤•à¤¿à¤‚à¤—", "à¤‹à¤£"])) {
        facts.push({
          q: "à¤¬à¥ˆà¤‚à¤•à¤¿à¤‚à¤— à¤ªà¥à¤°à¤£à¤¾à¤²à¥€ à¤•à¤¾ à¤®à¥à¤–à¥à¤¯ à¤•à¤¾à¤°à¥à¤¯ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?",
          ans: "à¤‹à¤£ à¤”à¤° à¤®à¥à¤¦à¥à¤°à¤¾ à¤•à¤¾ à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨"
        });
      }

      /* 9ï¸âƒ£ Government Policy */
      if (has(line, ["à¤¸à¤°à¤•à¤¾à¤°", "à¤†à¤°à¥à¤¥à¤¿à¤• à¤¨à¥€à¤¤à¤¿"])) {
        facts.push({
          q: "à¤¦à¥‡à¤¶ à¤•à¥€ à¤†à¤°à¥à¤¥à¤¿à¤• à¤¨à¥€à¤¤à¤¿ à¤•à¥Œà¤¨ à¤¨à¤¿à¤°à¥à¤§à¤¾à¤°à¤¿à¤¤ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ?",
          ans: "à¤•à¥‡à¤‚à¤¦à¥à¤° à¤¸à¤°à¤•à¤¾à¤°"
        });
      }

    });

    return facts;
  }

  /* ======================================================
     ðŸ§© MCQ GENERATOR
  ====================================================== */

  function convertFactsToMCQ(facts) {
    return facts.map(f => {

      const wrongOptions = generateWrongs(f.ans);
      let options = shuffle([f.ans, wrongOptions[0], wrongOptions[1], "à¤…à¤¨à¥à¤¯"]);
      const correct = ["A", "B", "C", "D"][options.indexOf(f.ans)];

      return {
        q: f.q,
        options,
        correct,
        explain: "à¤µà¥à¤¯à¤¾à¤–à¥à¤¯à¤¾: " + f.ans + " à¤²à¥‡à¤– à¤®à¥‡à¤‚ à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤°à¥‚à¤ª à¤¸à¥‡ à¤‰à¤²à¥à¤²à¥‡à¤–à¤¿à¤¤ à¤¹à¥ˆà¥¤"
      };
    });
  }

  /* ======================================================
     ðŸ”§ HELPERS
  ====================================================== */

  function normalize(text) {
    return text
      .replace(/\s+/g, " ")
      .split(/[à¥¤.\n]/)
      .map(l => l.trim())
      .filter(l => l.length > 15);
  }

  function has(line, keywords) {
    return keywords.every(k => line.includes(k));
  }

  function generateWrongs(correct) {
    const pool = [
      "à¤•à¥‡à¤µà¤² à¤¨à¤¿à¤œà¥€ à¤•à¥à¤·à¥‡à¤¤à¥à¤°",
      "à¤•à¥‡à¤µà¤² à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤•à¥à¤·à¥‡à¤¤à¥à¤°",
      "à¤…à¤¸à¥à¤¥à¤¾à¤¯à¥€ à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾",
      "à¤•à¥‹à¤ˆ à¤‰à¤²à¥à¤²à¥‡à¤– à¤¨à¤¹à¥€à¤‚"
    ];
    return pool.filter(x => x !== correct);
  }

  function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
  }

  function deduplicateFacts(facts) {
    const seen = new Set();
    return facts.filter(f => {
      const key = f.q + "|" + f.ans;
      if (seen.has(key)) return false;
      seen.add(key);
      return true;
    });
  }

})();
